function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}!function(t){"use strict";t.fn.rtWpVGallery=function(){return this._item=t(this),this._target=this._item.parent(),this._product=this._item.closest(".product"),this._default_gallery_images=this.data("default-images")||[],this._variation_form=this._product.find(".variations_form"),this._product_id=this._variation_form.data("product_id"),this._is_variation_product=!!this._variation_form.length,this._is_bundle_product=this._item.hasClass("rtwpvg-product-type-bundle"),this._slider=t(".rtwpvg-slider",this._item),this._thumbnail=t(".rtwpvg-thumbnail-slider",this._item),this.initial_load=!0,this.is_vertical=!!rtwpvg.is_vertical,this.removeLoading=function(){this._item.removeClass("loading-rtwpvg")},this.addLoading=function(){this._item.addClass("loading-rtwpvg")},this.loadDefaultGalleryImages=function(){if(this._is_variation_product&&!this._default_gallery_images.length){var t=this;wp.ajax.send("rtwpvg_get_default_gallery_images",{data:{product_id:this._product_id},success:function(i){t._default_gallery_images=i,t._item.trigger("rtwpvg_default_gallery_image_loaded")},error:function(i){t._default_gallery_images=[],t._item.trigger("rtwpvg_default_gallery_image_loaded")}})}},this.loadSlider=function(){var i=this;try{this._slider.hasClass("slick-initialized")&&this._slider.slick("unslick")}catch(t){}this._slider.off("init"),this._slider.off("beforeChange"),this._slider.off("afterChange"),this._item.trigger("rtwpvg_before_init"),this._slider.on("init",(function(t){i.initial_load&&(i.initial_load=!1)})).on("beforeChange",(function(t,e,a,o){i._thumbnail.find(".rtwpvg-thumbnail-image").not(".slick-slide").removeClass("current-thumbnail").eq(o).addClass("current-thumbnail")})).on("afterChange",(function(t,e,a){i.stopVideo(i._slider),i.loadZoom(a)})).slick(),this._thumbnail.find(".rtwpvg-thumbnail-image").not(".slick-slide").first().addClass("current-thumbnail"),this._thumbnail.find(".rtwpvg-thumbnail-image").not(".slick-slide").each((function(e,a){t(a).find("div, img").on("click",(function(t){t.preventDefault(),t.stopPropagation(),i._slider.slick("slickGoTo",e)}))})),rtwpvg.is_vertical&&rtwpvg.enable_thumbnail_slide&&(t(window).on("resize",i.setThumbnailPositionOnResize()),this._slider.on("setPosition",i.setThumbnailHeightOnSetPosition()),this._slider.on("afterChange",(function(){i.setThumbnailHeight()})));var e=this._thumbnail.find(".rtwpvg-thumbnail-image");parseInt(rtwpvg.thumbnails_columns)<e.length&&rtwpvg.enable_thumbnail_slide?(e.removeClass("current-thumbnail"),this.loadThumbnailSlider()):this._slider.slick("slickSetOption","asNavFor",null,!1),setTimeout((function(){i._item.trigger("rtwpvg_slider_init")}),1),setTimeout((function(){i.removeLoading()}),1)},this.stopVideo=function(i){t(i).find("iframe, video").each((function(){var i=t(this).prop("tagName").toLowerCase();if("iframe"===i){var e=t(this).attr("src");t(this).attr("src",e)}"video"===i&&t(this)[0].pause()}))},this.setThumbnailHeight=function(){this.is_vertical?this._slider.slick("getSlick").$slides.length>1?this._thumbnail.height(this._slider.height()):this._thumbnail.height(0):this._thumbnail.height("auto"),this._thumbnail.hasClass("slick-initialized")&&this._thumbnail.slick("setPosition")},this.setThumbnailHeightOnSetPosition=function(){var t=this;return this.setThumbnailHeight(),_.debounce((function(){t.setThumbnailHeight()}),401)},this.setThumbnailPositionOnResize=function(){var t=this;return t.setThumbnailPosition(),_.debounce((function(){t.setThumbnailPosition()}),400)},this.setThumbnailPosition=function(){rtwpvg.is_vertical&&(window.matchMedia("(max-width: 768px)").matches||window.matchMedia("(max-width: 480px)").matches?(this.is_vertical=!1,this._item.removeClass("rtwpvg-thumbnail-position-left rtwpvg-thumbnail-position-right rtwpvg-thumbnail-position-bottom"),this._item.addClass("rtwpvg-thumbnail-position-bottom"),this._slider.slick("setPosition")):(this.is_vertical=!0,this._item.removeClass("rtwpvg-thumbnail-position-left rtwpvg-thumbnail-position-right rtwpvg-thumbnail-position-bottom"),this._item.addClass("rtwpvg-thumbnail-position-"+rtwpvg.thumbnail_position),this._slider.slick("setPosition")))},this.loadThumbnailSlider=function(){var t=this;try{this._thumbnail.hasClass("slick-initialized")&&this._thumbnail.slick("unslick")}catch(t){}this._thumbnail.off("init"),this._thumbnail.on("init",(function(){})).slick(),setTimeout((function(){t._item.trigger("rtwpvg_thumbnail_slider_init")}),1)},this.callZoom=function(){var t=this._slider.slick("slickCurrentSlide");this.loadZoom(t)},this.loadZoom=function(i){if(rtwpvg.enable_zoom){var e=parseInt(this._target.width()),a=!1,o=this._slider.slick("getSlick").$slides.eq(i);if(t(o).each((function(i,o){var s=t(o).find("img");if(parseInt(s.data("large_image_width"))>e)return a=!0,!1})),t.fn.zoom&&a){var s=t.extend({touch:!1},wc_single_product_params.zoom_options);"ontouchstart"in document.documentElement&&(s.on="click"),o.trigger("zoom.destroy"),o.zoom(s)}}},this.loadPhotoSwipe=function(){var t=this;rtwpvg.enable_lightbox&&(this._item.off("click",".rtwpvg-trigger"),this._item.on("click",".rtwpvg-trigger",(function(i){t.openPhotoSwipe(i)})),rtwpvg.lightbox_image_click&&(this._item.off("click",".rtwpvg-gallery-image"),this._item.on("click",".rtwpvg-gallery-image",(function(i){t.openPhotoSwipe(i)}))))},this.openPhotoSwipe=function(i){if(i.preventDefault(),"undefined"==typeof PhotoSwipe)return!1;var e=this,a=t(".pswp")[0],o=this.getGalleryItems(),s=t.extend({index:this._slider.slick("slickCurrentSlide")},wc_single_product_params.photoswipe_options),r=new PhotoSwipe(a,PhotoSwipeUI_Default,o,s);r.listen("close",(function(){e.stopVideo(a)})),r.listen("afterChange",(function(){e.stopVideo(a)})),r.init()},this.getGalleryItems=function(){var i=this._slider.slick("getSlick").$slides,e=[];return i.length>0&&i.each((function(i,a){var o=t(a).find("img, iframe, video"),s=void 0;switch(t(o).prop("tagName").toLowerCase()){case"img":s={src:o.attr("data-large_image"),w:o.attr("data-large_image_width"),h:o.attr("data-large_image_height"),title:o.attr("data-caption")?o.attr("data-caption"):o.attr("title")};break;case"iframe":s={html:'<iframe class="rtwpvg-lightbox-iframe" src="'+o.attr("src")+'" style="width: 100%; height: 100%; margin: 0;padding: 0; background-color: #000000" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>'};break;case"video":s={html:'<video class="rtwpvg-lightbox-video" controls controlsList="nodownload" src="'+o.attr("src")+'" style="width: 100%; height: 100%; margin: 0;padding: 0; background-color: #000000"></video>'}}e.push(s)})),e},this.destroySlider=function(){this._slider.html(""),this._thumbnail.html("");try{this._slider.hasClass("slick-initialized")&&this._slider.slick("unslick"),this._thumbnail.hasClass("slick-initialized")&&this._thumbnail.slick("unslick")}catch(t){}this._item.trigger("rtwpvg_slider_destroy")},this.loadGallery=function(t){var i=this,e=t.length>1;this._item.trigger("before_rtwpvg_load",[t]),this.destroySlider(),console.log(_typeof(t));var a=t.map((function(t){return wp.template("rtwpvg-slider-template")(t)})).join(""),o=t.map((function(t){return wp.template("rtwpvg-thumbnail-template")(t)})).join("");this._slider.html(a),e?(this._target.addClass("rtwpvg-has-product-thumbnail"),this._thumbnail.html(o)):(this._target.removeClass("rtwpvg-has-product-thumbnail"),this._thumbnail.html("")),setTimeout((function(){i.imagesLoaded()}),1)},this.resetGallery=function(){var t=this;this._default_gallery_images.length>0?this.loadGallery(this._default_gallery_images):setTimeout((function(){t.removeLoading()}),1)},this.imagesLoaded=function(){var i=this;if(t.fn.imagesLoaded.done)return this._item.trigger("rtwpvg_image_loading",[i]),void this._item.trigger("rtwpvg_image_loaded",[i]);this._item.imagesLoaded().progress((function(t,e){i._item.trigger("rtwpvg_image_loading",[i])})).done((function(t){i._item.trigger("rtwpvg_image_loaded",[i])}))},this.loadVariationGallery=function(){var t=this;this._variation_form.off("reset_image.rtwpvg"),this._variation_form.off("click.rtwpvg"),this._variation_form.off("show_variation.rtwpvg"),rtwpvg.reset_on_variation_change?this._variation_form.on("reset_image.rtwpvg",(function(i){t.addLoading(),t.resetGallery()})):this._variation_form.on("click.rtwpvg",".show_variation",(function(i){t.addLoading(),t.resetGallery()})),this._variation_form.on("show_variation.rtwpvg",(function(i,e){t.addLoading(),t.loadGallery(e.variation_gallery_images)}))},this.loadEvents=function(){this._item.on("rtwpvg_image_loaded",this.init.bind(this))},this.init=function(t){var i=this;setTimeout((function(){i.loadSlider(),i.callZoom(),i.loadPhotoSwipe()}),1)},this.start=function(){this._is_bundle_product&&(this._product_id=this._variation_form.data("bundle_id")),this.loadDefaultGalleryImages(),this.loadEvents(),this.is_variation_product&&(this.loadSlider(),this.callZoom(),this.loadPhotoSwipe()),this.is_variation_product&&!this._is_bundle_product||this.imagesLoaded(),this._is_bundle_product||this.loadVariationGallery(),this._variation_form.trigger("reload_product_variations"),t(document).trigger("rtwpvg_loaded")},this.start(),this},t(window).on("load",(function(){t(".rtwpvg-wrapper:not(.rtwpvg-product-type-variable)").rtWpVGallery()})),t(document).on("wc_variation_form",".variations_form",(function(){t(".rtwpvg-wrapper").rtWpVGallery()})),t(document.body).on("post-load",(function(){t(".rtwpvg-wrapper").rtWpVGallery()})),t(document.body).on("jckqv_open",(function(){t(".rtwpvg-wrapper").rtWpVGallery()})),t(document.body).on("quick-view-displayed",(function(){t(".rtwpvg-wrapper").rtWpVGallery()})),t(document).on("qv_loader_stop",(function(){t(".rtwpvg-wrapper:not(.rtwpvg-product-type-variable)").rtWpVGallery()}))}(jQuery);
